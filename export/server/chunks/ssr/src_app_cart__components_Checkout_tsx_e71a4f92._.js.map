{"version":3,"sources":["turbopack:///[project]/src/app/cart/_components/Checkout.tsx"],"sourcesContent":["\"use client\";\r\nimport clsx from \"clsx\";\r\nimport * as z from \"zod\";\r\nimport { useForm } from \"react-hook-form\";\r\nimport { zodResolver } from \"@hookform/resolvers/zod\";\r\nimport { motion } from \"framer-motion\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { RootState } from \"@/store/store\";\r\nimport { useEffect } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { axiosInstance } from \"@/lib/axios\";\r\nimport { ToggleSummary, ViderCart } from \"@/store/productSlice\";\r\nimport Link from \"next/link\";\r\nimport Image from \"next/image\";\r\nconst CheckoutComponent = () => {\r\n  const { cart } = useSelector((state: RootState) => state.cart);\r\n  const router = useRouter();\r\n  const dispatch = useDispatch();\r\n\r\n  //ZOD\r\n  const contactSchema = z.object({\r\n    fullName: z.string().min(1, \"Le nom complet est requis\"),\r\n    email: z.string().email(\"Email invalide\"),\r\n    city: z.string().min(1, \"La ville est requis\").max(50),\r\n    adress: z.string().min(10, \"L'adress doit contenir au moins 10 caractères\"),\r\n    phone: z\r\n      .string()\r\n      .min(1, \"Le téléphone est requis\")\r\n      .regex(/^\\+?\\d{10,15}$/, \"Numéro de téléphone invalide\"),\r\n  });\r\n  type ContactFormData = z.infer<typeof contactSchema>;\r\n\r\n  //use form hook\r\n  const {\r\n    register,\r\n    \r\n    handleSubmit,\r\n    reset,\r\n    formState: { errors, isSubmitting, isSubmitSuccessful },\r\n  } = useForm<ContactFormData>({\r\n    resolver: zodResolver(contactSchema),\r\n  }); \r\n  const onSubmit = async (commande: ContactFormData) => {\r\n    const products = cart.map((item) => {\r\n      return { id: item.id, quantity: item.quantity };\r\n    });\r\n    const myData = {\r\n      commande,\r\n      products,\r\n    };\r\n\r\n    try{\r\n      const res = await axiosInstance.post(\r\n        \"/api/commandes/store\",\r\n        JSON.stringify(myData),\r\n        {\r\n          headers: { \"Content-Type\": \"application/json\" },\r\n        }\r\n      ); \r\n      \r\n      if (res.status == 200) {\r\n        dispatch(ToggleSummary(false));\r\n\r\n        const timer = setTimeout(() => {\r\n                  dispatch(ViderCart()); \r\n// \r\n          reset();\r\n          dispatch(ToggleSummary(true));\r\n        \r\n        }, 7000);\r\n        return ()=>clearTimeout(timer)\r\n      }}catch(error:unknown)\r\n    {\r\nalert('Réessayez la validation de la commande, il y a un problème')   \r\ndispatch(ViderCart())\r\n}\r\n    \r\n  };\r\n//Protected Route \r\nuseEffect(()=>{\r\nif(cart.length==0){\r\nrouter.push('/products_categories')\r\n}\r\n},[cart,router])\r\n  return isSubmitSuccessful? (\r\n    <div className=\" md:w-1/2 mx-auto flex select-none  justify-center items-center font-A  flex-col gap-y-5\">\r\n      <div className=\"relative h-52 w-52 \">\r\n        <Image\r\n          fill\r\n          alt=\"icon confirmation\"\r\n          src={\r\n            \"/images/cart/iconconfirm.webp\"\r\n          }\r\n          className=\"w-full h-full absolute pointer-events-none object-cover\"\r\n        />\r\n      </div>\r\n      <div className=\"flex flex-col justify-center items-center\">\r\n        <h1 className=\"   text-center font-D text-2xl\">\r\n          Votre commande a été enregistrée avec succès.\r\n        </h1>\r\n        <p className=\"text-center max-w-md text-grey\">\r\n          Nous vous contacterons par téléphone pour confirmer votre commande\r\n        </p>\r\n      </div>\r\n      <Link\r\n        href={\"/products_categories\"}\r\n        className=\"w-fit text-sm flex bg-second-hover font-D  border p-2 rounded-lg text-center bg-second text-white\"\r\n      >\r\n        Continuer vos achats\r\n      </Link>\r\n    </div>\r\n  ) : (\r\n    <div className=\"flex flex-col gap-y-5 w-full\">\r\n      <h1 className=\" font-D text-3xl tracking-wider\">\r\n        Validation de la commande\r\n      </h1>\r\n      <motion.div\r\n        key={1}\r\n        className=\" border-t border-[#eeeded]   flex flex-col gap-y-5 rounded-xl shadow-2xl shadow-[#d9d5d5c9] p-5 w-full\"\r\n      >\r\n        <form onSubmit={handleSubmit(onSubmit)} className=\"flex flex-col gap-4\">\r\n          <div className=\"grid sm:grid-cols-2 gap-4\">\r\n            <div className=\"flex flex-col gap-y-1\">\r\n              <input\r\n                autoComplete=\"name\"\r\n                placeholder=\"Entrez votre nom et prénom...\"\r\n                {...register(\"fullName\")}\r\n                name=\"fullName\"\r\n                className={clsx(\r\n                  errors.fullName\r\n                    ? \"border-[red] placeholder:text-[#ff000083]\"\r\n                    : \"border-gray-300 \",\r\n                  \"form-input\"\r\n                )}\r\n                type=\"text\"\r\n              />\r\n              {errors.fullName && (\r\n                <p className=\"error-input\">{errors.fullName.message}</p>\r\n              )}\r\n            </div>\r\n            <div className=\"flex flex-col gap-y-1\">\r\n              <input\r\n                autoComplete=\"email\"\r\n                {...register(\"email\")}\r\n                name=\"email\"\r\n                className={clsx(\r\n                  errors.email\r\n                    ? \"border-[red] placeholder:text-[#ff000083]\"\r\n                    : \"border-gray-300 \",\r\n                  \"form-input\"\r\n                )}\r\n                placeholder=\"Entrez votre Email...\"\r\n                type=\"email\"\r\n              />\r\n              {errors.email && (\r\n                <p className=\"error-input\">{errors.email.message}</p>\r\n              )}\r\n            </div>\r\n          </div>\r\n          <div className=\"grid sm:grid-cols-2 gap-4\">\r\n            <div className=\"w-full flex flex-col gap-y-1\">\r\n              <div className=\"flex flex-col gap-y-1\">\r\n                <input\r\n                  autoComplete=\"tel\"\r\n                  {...register(\"phone\")}\r\n                  name=\"phone\"\r\n                  className={clsx(\r\n                    errors.phone\r\n                      ? \"border-[red] placeholder:text-[#ff000083]\"\r\n                      : \"border-gray-300 \",\r\n                    \"form-input\"\r\n                  )}\r\n                  type=\"tel\"\r\n                  placeholder=\"Entrez votre Téléphone...\"\r\n                />\r\n                {errors.phone && (\r\n                  <p className=\"error-input\">{errors.phone.message}</p>\r\n                )}\r\n              </div>\r\n            </div>\r\n            <div className=\"flex flex-col gap-y-1\">\r\n              <input\r\n                autoComplete=\"address-level1\"\r\n                placeholder=\"Entrez  La ville...\"\r\n                {...register(\"city\")}\r\n                name=\"city\"\r\n                className={clsx(\r\n                  errors.city\r\n                    ? \"border-[red] placeholder:text-[#ff000083]\"\r\n                    : \"border-gray-300 \",\r\n                  \"form-input\"\r\n                )}\r\n                type=\"text\"\r\n              />\r\n              {errors.city && (\r\n                <p className=\"error-input\">{errors.city.message}</p>\r\n              )}\r\n            </div>\r\n          </div>\r\n          <div className=\"flex flex-col gap-y-1\">\r\n            <textarea\r\n              autoComplete=\"address-level1\"\r\n              placeholder=\"Entrez L'adress...\"\r\n              {...register(\"adress\")}\r\n              name=\"adress\"\r\n              className={clsx(\r\n                errors.adress\r\n                  ? \"border-[red] placeholder:text-[#ff000083]\"\r\n                  : \"border-gray-300 \",\r\n                \"form-input   px-4 py-3 h-32 resize-none\"\r\n              )}\r\n            ></textarea>\r\n            {errors.adress && (\r\n              <p className=\"error-input\">{errors.adress.message}</p>\r\n            )}\r\n          </div>\r\n          <button  disabled={isSubmitting} className={clsx(isSubmitting&&\"opacity-[0.8]\",\" bg-main bg-main-hover kinatech-btn w-fit \")}>\r\n            {isSubmitting ? \"en cours...\" : \"Commander\"}\r\n          </button>\r\n        </form>\r\n      </motion.div>\r\n    </div>\r\n  );\r\n};\r\nexport default CheckoutComponent;\r\n"],"names":[],"mappings":"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"}